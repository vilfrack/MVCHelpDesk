@model IEnumerable<MVCHelpDesk.ViewModel.ViewPermisos>
    <h1>Usuarios creados</h1>


@using (Html.BeginForm("Index", "Permisos", FormMethod.Post, new { @id = "frmIndex"})) {
    <table id="tablePermisos" class="table table-striped table-bordered" cellspacing="0">
        @foreach (var varModulo in Model.Select(s => new { s.ModuloID, s.ModuloDescripcion }).Distinct().ToList())
        {
            <thead style="background-color:#E0F2F1">
                <tr>
                    <th>@varModulo.ModuloID</th>
                    <th>@varModulo.ModuloDescripcion</th>
                    <th>Rol</th>
                    <th>Usuario</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var itemModel in Model.Where(w => w.ModuloID == varModulo.ModuloID).Select(s => new { s.PermisoID, s.PermisoDescripcion, s.CheekRol, s.CheekUsuarios }).Distinct().ToList())
                {
                    <tr>
                        <td>
                            <label style="padding-left:20px;">@itemModel.PermisoID</label>
                        </td>
                        <td>
                            <label style="padding-left:20px;"> @itemModel.PermisoDescripcion</label>
                        </td>
                        <td>
                            @Html.CheckBox("CheekRol", itemModel.CheekRol, new { data_permiso = itemModel.PermisoID,data_modulo= varModulo.ModuloID })
                        </td>
                        <td>
                            @Html.CheckBox("CheekUsuario", itemModel.CheekUsuarios, new { data_permiso = itemModel.PermisoID, data_modulo = varModulo.ModuloID }))
                        </td>
                    </tr>
                }
            </tbody>
        }
    </table>
    <button type="submit" id="btnSave" class="btn btn-primary btn-group-lg"><i class="fa fa-save"></i> Guardar</button>

}
    <script>
        var permissionUser = [];
        var permissionRole = [];
        $("input[name='CheekRol']").on('click', function () {
            var permiso = $(this).data("permiso");
            var modulo = $(this).data("modulo");

            if ($(this).is(':checked')) {
                permissionRole.push({
                    permisoID: permiso,
                    moduloID: modulo
                });
            } else {
                // findIndex NOS PERMITE BUSCAR EL INDICE DEL OBJETO, PASANDOLE LOS VALORES A BUSCAR
                index = permissionRole.findIndex(x => x.permisoID == permiso && x.moduloID == modulo);
                if (index != -1) {
                    //.splice PERMITE BORRAR EL INDICE DEL OBJETO
                    permissionRole.splice(index, 1);
                }
            }
            });
        $("input[name='CheekUsuario']").on('click', function () {
            var permiso = $(this).data("permiso");
            var modulo = $(this).data("modulo");

            if ($(this).is(':checked')) {
                permissionUser.push({
                    permisoID: permiso,
                    moduloID: modulo
                });
            } else {
                // findIndex NOS PERMITE BUSCAR EL INDICE DEL OBJETO, PASANDOLE LOS VALORES A BUSCAR
                index = permissionUser.findIndex(x => x.permisoID == permiso && x.moduloID == modulo);
                if (index != -1) {
                    //.splice PERMITE BORRAR EL INDICE DEL OBJETO
                    permissionUser.splice(index, 1);
                }
            }
        });
    </script>
